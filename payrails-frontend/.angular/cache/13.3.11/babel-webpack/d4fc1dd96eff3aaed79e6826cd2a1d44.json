{"ast":null,"code":"import _asyncToGenerator from \"/Users/ahmedyehiakhater/payrails-product-assessment/payrails-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// import { PayrailsCSE } from '@payrails/web-cse';\nimport * as jose from 'node-jose';\nimport * as i0 from \"@angular/core\";\nexport class EncryptionService {\n  constructor(ngZone) {\n    this.ngZone = ngZone;\n  }\n\n  encryptData(data, publicKeyString) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        let pemKey = _this.formatPublicKeyAsPEM(publicKeyString);\n\n        const key = yield _this.importPublicKey(pemKey);\n        const buffer = new TextEncoder().encode(JSON.stringify(data));\n        const encrypted = yield jose.JWE.createEncrypt({\n          format: 'compact'\n        }, key).update(buffer).final();\n        console.log(\"Encryption is\", encrypted);\n        return encrypted;\n      } catch (error) {\n        console.error('Encryption failed:', error);\n        return '';\n      }\n    })();\n  }\n\n  importPublicKey(pem) {\n    return _asyncToGenerator(function* () {\n      const keystore = jose.JWK.createKeyStore();\n      return keystore.add(pem, 'pem');\n    })();\n  }\n\n  formatPublicKeyAsPEM(publicKey) {\n    const pemHeader = '-----BEGIN PUBLIC KEY-----';\n    const pemFooter = '-----END PUBLIC KEY-----'; // Add newline characters if they are not present\n\n    const normalizedKey = publicKey.replace(/^-----BEGIN PUBLIC KEY-----/, '').replace(/-----END PUBLIC KEY-----$/, '').trim();\n    return `${pemHeader}\\n${normalizedKey}\\n${pemFooter}`;\n  } // async clientSideEncryption(creditCardModel: any) {\n  //   let initResponse = {\n  //     \"version\": \"1.0.0\",\n  //     \"data\": \"eyJ0b2tlbiI6ImV5SmhiR2NpT2lKU1V6STFOaUlzSW10cFpDSTZJbU5tT0RGak5USmxMVGN6WVRBdE5EQTBNQzA1WTJWaUxXRXdOMk16WVdZNE5qUm1PU0lzSW5SNWNDSTZJa3BYVkNKOS5leUpoZFdRaU9sc2ljR0Y1Y21GcGJITXRZbUZqYTJWdVpDSmRMQ0psZUhBaU9qRTJPVGcxT1RZd05qVXNJbWgwZEhCek9pOHZjR0Y1Y21GcGJITXVhVzh2WTJ4aGFXMXpMMk4xYzNSdmJWOXpZMjl3WlNJNkludGNJbUZzYkc5M2MwRnNiRndpT21aaGJITmxMRndpWlhobFkzVjBhVzl1U1dSY0lqcGNJbHdpTEZ3aWFHOXNaR1Z5VW1WbVpYSmxibU5sWENJNlhDSlFZWGx5WVdsc2N5QlFjbTlrZFdOMElHRnpjMlZ6YzIxbGJuUmNJaXhjSW5SdmEyVnVhWHBoZEdsdmJrbGtYQ0k2WENJNVltWTBaRGMxWmkwek16UTRMVFJoTkRVdE9ERTRNQzFqTlRobFpqazRNRGN6TlRWY0lpeGNJblI1Y0dWY0lqcGNJbU5zYVdWdWRGd2lmU0lzSW1semN5STZJbkJoZVhKaGFXeHpJaXdpYTJsa0lqb2lZMlk0TVdNMU1tVXROek5oTUMwME1EUXdMVGxqWldJdFlUQTNZek5oWmpnMk5HWTVJaXdpY0dWeWJXbHpjMmx2Ym5NaU9sc2lZMnhwWlc1ME9tVjRaV04xZEdsdmJuTTZZWFYwYUc5eWFYcGxJaXdpWTJ4cFpXNTBPbVY0WldOMWRHbHZibk02WTI5dVptbHliU0lzSW1Oc2FXVnVkRHBsZUdWamRYUnBiMjV6T25KbFlXUWlMQ0pqYkdsbGJuUTZhVzV6ZEhKMWJXVnVkSE02WTNKbFlYUmxJaXdpWTJ4cFpXNTBPbWx1YzNSeWRXMWxiblJ6T25SdmEyVnVhWHBsSWwwc0luTjFZaUk2SW0xbGNtTm9ZVzUwTFhOa2F5SjkuZ2VWTmxRdHU2OE1jc21ZemI3WGFRX2lRcnB2T0JVTmJzRVJVYjl3M09EOXJfMGZ2M0M0OEkxSExCQjkwekRKSkgxanRkRmo4a1lFUFdVNFZ5LVRER1lqZTcwWk5CUG1iZ3k4RDVIRWpONVRKeTl3SVdrMXpsbEl4TnVGNlE3MHF3dklUSWNYWnBwWHQ2blhKNWVTZE5pQU5UdTVRLXpuQkhIX3FmcHRPRTRfaWt1ZExCRThfZzVkUHBnZEFRcFF0am4yOV80OXhVMG1qZENHV2l0bXNvSHYyZXE1bnNmMjdHWkFRUERoZlFUT1RhckJPWThYb1h0MEQ3MlplNGpPaUx2SUFLek5BQ3lwZVVTZkNhd2tleWt4Q3h3SWxVQmxBY3hUUVRjWTRha05NTDRfcF90UUx5M3dCME9TXzlGbnYtQU1OSy0wb0I4bHhLSXRiNGZpNUdnIiwiaG9sZGVyUmVmZXJlbmNlIjoiUGF5cmFpbHMgUHJvZHVjdCBhc3Nlc3NtZW50IiwidG9rZW5pemF0aW9uIjp7ImlkIjoiOWJmNGQ3NWYtMzM0OC00YTQ1LTgxODAtYzU4ZWY5ODA3MzU1IiwicHVibGljS2V5IjoiTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUEza09NOGZUWGE3b01kWXhHQ2E5dThaNnltMkxkY3p0Mng3a0FtSEtWOWpUOFlHN1BhR3h2NEU1blJqWm5UOU9VMGZaWkFHVUduZzFSRHJSYUNGd2NacE9ENW01NnNHMUxhWVE4ZGtheFNHMk0xQnluTGVLOVhSaVpFbXgxSmhEMFBrNG1tNXNJRklnM09hNDg2Q1dNVnJqZ0Nwc0YxVklnVDd5R29OT2s4dGRPcVBaMjA2QVRYZCs1QnhBclEzYXVwOXppRDBuc2s2NkNSY2hYVkNnRjdHYy95U0VzYytCM0doRjRxcUZTdlpiQUo0aEcxdWMxLzhHMlhiS29KSWRwZ2M0UWF2bnZ0QURBVEpCbXF5SGlvNzBkczc2Z1FKQU1zOHVNcGdOOUZPcVlxajVYU0VYOUsvV2JIUUJucWpCb3ByWlBuZ3E4aHpIdWtieDhYaHFyZlFJREFRQUIiLCJsaW5rcyI6eyJ0b2tlbml6ZSI6eyJtZXRob2QiOiJQT1NUIiwiaHJlZiI6Imh0dHBzOi8vcGF5cmFpbHMtYXBpLXB1Yi5zdGFnaW5nLnBheXJhaWxzLmlvL3B1YmxpYy9wYXltZW50L2luc3RydW1lbnRzL3Rva2VuaXplIn19fX0\"\n  //   }\n  //   const cse = PayrailsCSE.init(initResponse);\n  //   const tokenizedCard = await cse.tokenize(creditCardModel);\n  //   console.log({ tokenizedCard });\n  // }\n\n  /**\n   * The following is in case we need to encrypt using encryption algorithm RSA-OAEP-256 and content encryption A256CBC-HS512 but without JWE - this should be done strictly from server side\n   * @param creditCardModel\n   * @param publicKey\n   * @returns\n   */\n\n\n  encryptCreditCard(creditCardModel, publicKey) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const cryptoKey = yield _this2.importKey(publicKey);\n      const encodedText = new TextEncoder().encode(JSON.stringify(creditCardModel)); // Use NgZone.run to ensure that change detection is aware of the asynchronous operation\n\n      return _this2.ngZone.run( /*#__PURE__*/_asyncToGenerator(function* () {\n        const encryptedData = yield crypto.subtle.encrypt({\n          name: 'RSA-OAEP-256'\n        }, cryptoKey, encodedText);\n        return btoa(String.fromCharCode(...new Uint8Array(encryptedData)));\n      }));\n    })();\n  } // Import the public key for encryption\n\n\n  importKey(publicKey) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      // Convert the base64-encoded public key to an ArrayBuffer\n      const keyBuffer = yield crypto.subtle.importKey('spki', _this3.base64ToArrayBuffer(publicKey), {\n        name: 'RSA-OAEP',\n        hash: 'SHA-256'\n      }, true, ['encrypt']);\n      return keyBuffer;\n    })();\n  } // Convert a base64-encoded string to an ArrayBuffer\n\n\n  base64ToArrayBuffer(base64) {\n    const binaryString = window.atob(base64);\n    const len = binaryString.length;\n    const bytes = new Array(len);\n\n    for (let i = 0; i < len; i++) {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n\n    return new Uint8Array(bytes).buffer;\n  }\n\n}\n\nEncryptionService.ɵfac = function EncryptionService_Factory(t) {\n  return new (t || EncryptionService)(i0.ɵɵinject(i0.NgZone));\n};\n\nEncryptionService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: EncryptionService,\n  factory: EncryptionService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["/Users/ahmedyehiakhater/payrails-product-assessment/payrails-frontend/src/app/services/encryption.service.ts"],"names":["jose","i0","EncryptionService","constructor","ngZone","encryptData","data","publicKeyString","pemKey","formatPublicKeyAsPEM","key","importPublicKey","buffer","TextEncoder","encode","JSON","stringify","encrypted","JWE","createEncrypt","format","update","final","console","log","error","pem","keystore","JWK","createKeyStore","add","publicKey","pemHeader","pemFooter","normalizedKey","replace","trim","encryptCreditCard","creditCardModel","cryptoKey","importKey","encodedText","run","encryptedData","crypto","subtle","encrypt","name","btoa","String","fromCharCode","Uint8Array","keyBuffer","base64ToArrayBuffer","hash","base64","binaryString","window","atob","len","length","bytes","Array","i","charCodeAt","ɵfac","EncryptionService_Factory","t","ɵɵinject","NgZone","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":"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","sourcesContent":["// import { PayrailsCSE } from '@payrails/web-cse';\nimport * as jose from 'node-jose';\nimport * as i0 from \"@angular/core\";\nexport class EncryptionService {\n    constructor(ngZone) {\n        this.ngZone = ngZone;\n    }\n    async encryptData(data, publicKeyString) {\n        try {\n            let pemKey = this.formatPublicKeyAsPEM(publicKeyString);\n            const key = await this.importPublicKey(pemKey);\n            const buffer = new TextEncoder().encode(JSON.stringify(data));\n            const encrypted = await jose.JWE.createEncrypt({ format: 'compact' }, key)\n                .update(buffer)\n                .final();\n            console.log(\"Encryption is\", encrypted);\n            return encrypted;\n        }\n        catch (error) {\n            console.error('Encryption failed:', error);\n            return '';\n        }\n    }\n    async importPublicKey(pem) {\n        const keystore = jose.JWK.createKeyStore();\n        return keystore.add(pem, 'pem');\n    }\n    formatPublicKeyAsPEM(publicKey) {\n        const pemHeader = '-----BEGIN PUBLIC KEY-----';\n        const pemFooter = '-----END PUBLIC KEY-----';\n        // Add newline characters if they are not present\n        const normalizedKey = publicKey\n            .replace(/^-----BEGIN PUBLIC KEY-----/, '')\n            .replace(/-----END PUBLIC KEY-----$/, '')\n            .trim();\n        return `${pemHeader}\\n${normalizedKey}\\n${pemFooter}`;\n    }\n    // async clientSideEncryption(creditCardModel: any) {\n    //   let initResponse = {\n    //     \"version\": \"1.0.0\",\n    //     \"data\": \"eyJ0b2tlbiI6ImV5SmhiR2NpT2lKU1V6STFOaUlzSW10cFpDSTZJbU5tT0RGak5USmxMVGN6WVRBdE5EQTBNQzA1WTJWaUxXRXdOMk16WVdZNE5qUm1PU0lzSW5SNWNDSTZJa3BYVkNKOS5leUpoZFdRaU9sc2ljR0Y1Y21GcGJITXRZbUZqYTJWdVpDSmRMQ0psZUhBaU9qRTJPVGcxT1RZd05qVXNJbWgwZEhCek9pOHZjR0Y1Y21GcGJITXVhVzh2WTJ4aGFXMXpMMk4xYzNSdmJWOXpZMjl3WlNJNkludGNJbUZzYkc5M2MwRnNiRndpT21aaGJITmxMRndpWlhobFkzVjBhVzl1U1dSY0lqcGNJbHdpTEZ3aWFHOXNaR1Z5VW1WbVpYSmxibU5sWENJNlhDSlFZWGx5WVdsc2N5QlFjbTlrZFdOMElHRnpjMlZ6YzIxbGJuUmNJaXhjSW5SdmEyVnVhWHBoZEdsdmJrbGtYQ0k2WENJNVltWTBaRGMxWmkwek16UTRMVFJoTkRVdE9ERTRNQzFqTlRobFpqazRNRGN6TlRWY0lpeGNJblI1Y0dWY0lqcGNJbU5zYVdWdWRGd2lmU0lzSW1semN5STZJbkJoZVhKaGFXeHpJaXdpYTJsa0lqb2lZMlk0TVdNMU1tVXROek5oTUMwME1EUXdMVGxqWldJdFlUQTNZek5oWmpnMk5HWTVJaXdpY0dWeWJXbHpjMmx2Ym5NaU9sc2lZMnhwWlc1ME9tVjRaV04xZEdsdmJuTTZZWFYwYUc5eWFYcGxJaXdpWTJ4cFpXNTBPbVY0WldOMWRHbHZibk02WTI5dVptbHliU0lzSW1Oc2FXVnVkRHBsZUdWamRYUnBiMjV6T25KbFlXUWlMQ0pqYkdsbGJuUTZhVzV6ZEhKMWJXVnVkSE02WTNKbFlYUmxJaXdpWTJ4cFpXNTBPbWx1YzNSeWRXMWxiblJ6T25SdmEyVnVhWHBsSWwwc0luTjFZaUk2SW0xbGNtTm9ZVzUwTFhOa2F5SjkuZ2VWTmxRdHU2OE1jc21ZemI3WGFRX2lRcnB2T0JVTmJzRVJVYjl3M09EOXJfMGZ2M0M0OEkxSExCQjkwekRKSkgxanRkRmo4a1lFUFdVNFZ5LVRER1lqZTcwWk5CUG1iZ3k4RDVIRWpONVRKeTl3SVdrMXpsbEl4TnVGNlE3MHF3dklUSWNYWnBwWHQ2blhKNWVTZE5pQU5UdTVRLXpuQkhIX3FmcHRPRTRfaWt1ZExCRThfZzVkUHBnZEFRcFF0am4yOV80OXhVMG1qZENHV2l0bXNvSHYyZXE1bnNmMjdHWkFRUERoZlFUT1RhckJPWThYb1h0MEQ3MlplNGpPaUx2SUFLek5BQ3lwZVVTZkNhd2tleWt4Q3h3SWxVQmxBY3hUUVRjWTRha05NTDRfcF90UUx5M3dCME9TXzlGbnYtQU1OSy0wb0I4bHhLSXRiNGZpNUdnIiwiaG9sZGVyUmVmZXJlbmNlIjoiUGF5cmFpbHMgUHJvZHVjdCBhc3Nlc3NtZW50IiwidG9rZW5pemF0aW9uIjp7ImlkIjoiOWJmNGQ3NWYtMzM0OC00YTQ1LTgxODAtYzU4ZWY5ODA3MzU1IiwicHVibGljS2V5IjoiTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUEza09NOGZUWGE3b01kWXhHQ2E5dThaNnltMkxkY3p0Mng3a0FtSEtWOWpUOFlHN1BhR3h2NEU1blJqWm5UOU9VMGZaWkFHVUduZzFSRHJSYUNGd2NacE9ENW01NnNHMUxhWVE4ZGtheFNHMk0xQnluTGVLOVhSaVpFbXgxSmhEMFBrNG1tNXNJRklnM09hNDg2Q1dNVnJqZ0Nwc0YxVklnVDd5R29OT2s4dGRPcVBaMjA2QVRYZCs1QnhBclEzYXVwOXppRDBuc2s2NkNSY2hYVkNnRjdHYy95U0VzYytCM0doRjRxcUZTdlpiQUo0aEcxdWMxLzhHMlhiS29KSWRwZ2M0UWF2bnZ0QURBVEpCbXF5SGlvNzBkczc2Z1FKQU1zOHVNcGdOOUZPcVlxajVYU0VYOUsvV2JIUUJucWpCb3ByWlBuZ3E4aHpIdWtieDhYaHFyZlFJREFRQUIiLCJsaW5rcyI6eyJ0b2tlbml6ZSI6eyJtZXRob2QiOiJQT1NUIiwiaHJlZiI6Imh0dHBzOi8vcGF5cmFpbHMtYXBpLXB1Yi5zdGFnaW5nLnBheXJhaWxzLmlvL3B1YmxpYy9wYXltZW50L2luc3RydW1lbnRzL3Rva2VuaXplIn19fX0\"\n    //   }\n    //   const cse = PayrailsCSE.init(initResponse);\n    //   const tokenizedCard = await cse.tokenize(creditCardModel);\n    //   console.log({ tokenizedCard });\n    // }\n    /**\n     * The following is in case we need to encrypt using encryption algorithm RSA-OAEP-256 and content encryption A256CBC-HS512 but without JWE - this should be done strictly from server side\n     * @param creditCardModel\n     * @param publicKey\n     * @returns\n     */\n    async encryptCreditCard(creditCardModel, publicKey) {\n        const cryptoKey = await this.importKey(publicKey);\n        const encodedText = new TextEncoder().encode(JSON.stringify(creditCardModel));\n        // Use NgZone.run to ensure that change detection is aware of the asynchronous operation\n        return this.ngZone.run(async () => {\n            const encryptedData = await crypto.subtle.encrypt({\n                name: 'RSA-OAEP-256',\n            }, cryptoKey, encodedText);\n            return btoa(String.fromCharCode(...new Uint8Array(encryptedData)));\n        });\n    }\n    // Import the public key for encryption\n    async importKey(publicKey) {\n        // Convert the base64-encoded public key to an ArrayBuffer\n        const keyBuffer = await crypto.subtle.importKey('spki', this.base64ToArrayBuffer(publicKey), {\n            name: 'RSA-OAEP',\n            hash: 'SHA-256',\n        }, true, ['encrypt']);\n        return keyBuffer;\n    }\n    // Convert a base64-encoded string to an ArrayBuffer\n    base64ToArrayBuffer(base64) {\n        const binaryString = window.atob(base64);\n        const len = binaryString.length;\n        const bytes = new Array(len);\n        for (let i = 0; i < len; i++) {\n            bytes[i] = binaryString.charCodeAt(i);\n        }\n        return new Uint8Array(bytes).buffer;\n    }\n}\nEncryptionService.ɵfac = function EncryptionService_Factory(t) { return new (t || EncryptionService)(i0.ɵɵinject(i0.NgZone)); };\nEncryptionService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: EncryptionService, factory: EncryptionService.ɵfac, providedIn: 'root' });\n"]},"metadata":{},"sourceType":"module"}